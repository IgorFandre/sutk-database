# База данных для поставщиков и покупателей металлопродукции и металлопроката.

## Прототип

### Средне-Уральская трубная компания

Сайт-визитка на гитхабе - [github](https://github.com/IgorFandre/golang-website)

Посмотреть запущенный сайт можно по [ссылке](https://sutk-igorfandre.amvera.io/).



## Концептуальное проектирование

### Предметная область: продажа металлопродукции

### Не детализированные сущности:
1. `Сотрудники` (с информацией: ID сотрудника, имя, фамилия, отчество, отдел)
2. `Департаменты` (с информацией: ID департамента, название, контактный телефон, контактная почта)
3. `Клиенты` (с информацией: ID клиента, название компании, контактное лицо, контактный телефон, ID менеджера, работающего с клиентом, адрес)
4. `Заказы` (с информацией: ID заказа, описание, товары, дата заказа, флаг самовывоза)
5. `Этапы заказов` (с информацией: ID этапа, ID заказа, исполнитель, даты начала и конца этапа)
6. `Продукты` (с информацией: ID товара, название, качество товара (номер ГОСТа), описание, цена единицы товара, количество на складе, вес единицы товара)

### Сущности будут связаны следующим образом:
1. В каждом департаменте не менее одного сотрудника (**один ко многим**).
2. На каждом этапе у заказа свой работник-исполнитель. Работник одновременно может брать этапы разных заказов (**один ко многим**).
3. У каждого клиента по одному менеджеру, привязанному к нему. Один менеджер может работать с несколькими клиентами (**один ко многим**).
4. У каждого заказа несколько этапов, обрабатываемых в определенном порядке (**один ко многим**).
5. Каждый заказ связан с одним клиентом, у клиента может быть много заказов (**один ко многим**).
6. Каждый заказ содержит товары и каждый товар может быть в нескольких заказах (**многие ко многим**).

### Схема 1:
![alt text](./src/entity_concept_map.png)

### Схема 2:
![alt text](./src/concept_map.png)


## Логическое проектирование

### Нормальная форма

Модель находится в __3 нормальной форме__:

1. Атрибуты преобразованы к атомарным
   - Каждая ячейка хранит только одно значение
   - В колонках данные одного типа
   - Все записи отличаются друг от друга
2. Все неключевые атрибуты зависят от первичного ключа
3. Никакие колонки не зависят друг от друга

### Версионирование

В логической модели мы поддерживаем версионность адресов клиентов и для каждого заказа берем именно тот адрес, который был у него на момент заказа. Наш выбор - __SCD типа 2__, для которого мы заводим отдельную таблицу addresses, в которой храним id клиента и время начала и конца использования адреса.

### Схема модели

![alt text](./src/logic_map.png)


## Физическое проектирование

### Файл с реализацией базы данных

`./sql_scripts/insert.sql`

### Накладываемые ограничения атрибутов в БД:

**departments (отделы):**
   - `name`: обязательное поле
   - `phone`: ограничение формата телефона, который должен соответствовать шаблону российского номера '+7\(\_ \_ \_ \)\_ \_ \_ \- \_ \_ \- \_ \_'
   - `email`: ограничение формата электронной почты


**workers (сотрудники):**
   - `name`: обязательное поле
   - `surname`: обязательное поле

**clients (клиенты):**
   - `company`: уникальное поле
   - `contact_name`: обязательное поле
   - `phone`: ограничение формата телефона, который должен соответствовать шаблону российского номера '+7\(\_ \_ \_ \)\_ \_ \_ \- \_ \_ \- \_ \_'

**addresses (адреса):**
   - `address`: обязательное поле

**orders (заказы):**
   - `delivery`: флаг доставки, обязательное поле
   - `order_date`: дата заказа, по умолчанию ставится текущее время

**steps (шаги):**
   - `step_combination`: уникальный ключ для комбинации `(worker_id, order_id, step_id)`.

**products (продукты):**
   - `name`: обязательное поле
   - `price`: числовое поле с двумя знаками после запятой, должно быть неотрицательным
   - `available`: целочисленное поле, должно быть неотрицательным
   - `weight`: числовое поле с тремя знаками после запятой, должно быть неотрицательным

**ordered_products (заказанные продукты):**
   - `count`: целочисленное поле, должно быть больше неотрицательным
   - `order_combination`: уникальный ключ для комбинации `(order_id, product_id)`.

